<app-header></app-header>
<div class="perfil-wrapper" *ngIf="datosUsuario; else cargandoPerfil">
  <div class="perfil-layout">
    <!-- Panel principal datos -->
    <section class="panel">
      <header class="panel-header">
        <h2>Perfil</h2>
        <div
          class="pill"
          [ngClass]="{
            prestamista: tipo === 1,
            prestatario: tipo === 2,
            admin: tipo === 3
          }"
        >
          {{
            tipo === 1 ? "Prestamista" : tipo === 2 ? "Prestatario" : "Admin"
          }}
        </div>
      </header>

      <div
        class="alert warn"
        *ngIf="!datosUsuario.nombre || !datosUsuario.telefono"
      >
        Falta información personal básica. Completa tu perfil para aprovechar
        todas las funciones.
      </div>

      <h3 class="section-title">Información general</h3>
      <div class="grid-fields">
        <div class="field">
          <label>Nombre</label>
          <div class="static-box">{{ datosUsuario.nombre || "—" }}</div>
        </div>
        <div class="field">
          <label>Apellido</label>
          <div class="static-box">{{ datosUsuario.apellido || "—" }}</div>
        </div>
        <div class="field">
          <label>Fecha nacimiento</label>
          <div class="static-box">
            {{
              datosUsuario.fecha_nacimiento
                ? (datosUsuario.fecha_nacimiento | date : "longDate")
                : "—"
            }}
          </div>
        </div>
        <div class="field">
          <label>Teléfono</label>
          <div class="static-box">{{ datosUsuario.telefono || "—" }}</div>
        </div>
        <div class="field full">
          <label>Correo</label>
          <div class="static-box">{{ datosUsuario.email }}</div>
        </div>
        <div class="field">
          <label>Ciudad</label>
          <div class="static-box">{{ datosUsuario.nombre_ciudad || "—" }}</div>
        </div>
        <div class="field">
          <label>Barrio</label>
          <div class="static-box">{{ datosUsuario.nombre_barrio || "—" }}</div>
        </div>
        <div class="field full">
          <label>Dirección</label>
          <div class="static-box">
            {{
              datosUsuario.calle1 && datosUsuario.calle2
                ? datosUsuario.calle1 + " y " + datosUsuario.calle2
                : "—"
            }}
          </div>
        </div>
      </div>

      <h3 class="section-title" *ngIf="tipo === 1 && datosPrestamista.capital">
        Datos de prestamista
      </h3>
      <div class="grid-fields" *ngIf="tipo === 1 && datosPrestamista.capital">
        <div class="field">
          <label>Capital disponible</label>
          <div class="static-box">
            {{ datosPrestamista.capital | currency : "USD" }}
          </div>
        </div>
        <div class="field">
          <label>Rango</label>
          <div class="static-box">{{ datosPrestamista.rango || "—" }}</div>
        </div>
        <div class="field">
          <label>Estado</label>
          <div class="static-box">
            {{ datosPrestamista.estado ? "Activo" : "Inactivo" }}
          </div>
        </div>
      </div>

      <div class="alert warn" *ngIf="tipo === 1 && !datosPrestamista.capital">
        Perfil de prestamista incompleto. Añade capital para ofrecer préstamos.
      </div>

      <h3
        class="section-title"
        *ngIf="tipo === 2 && datosPrestatario.nombre_negocio"
      >
        Datos de prestatario
      </h3>
      <div
        class="grid-fields"
        *ngIf="tipo === 2 && datosPrestatario.nombre_negocio"
      >
        <div class="field">
          <label>Negocio</label>
          <div class="static-box">{{ datosPrestatario.nombre_negocio }}</div>
        </div>
        <div class="field">
          <label>Ingresos mensuales</label>
          <div class="static-box">
            {{ datosPrestatario.ingreso_mensual | currency : "USD" }}
          </div>
        </div>
        <div class="field">
          <label>Calificación crediticia</label>
          <div class="static-box">
            {{ datosPrestatario.calificacion_crediticia || "—" }}
          </div>
        </div>
        <div class="field">
          <label>Ciudad</label>
          <div class="static-box">
            {{ datosPrestatario.nombre_ciudad || "—" }}
          </div>
        </div>
        <div class="field">
          <label>Barrio</label>
          <div class="static-box">
            {{ datosPrestatario.nombre_barrio || "—" }}
          </div>
        </div>
        <div class="field full">
          <label>Dirección</label>
          <div class="static-box">
            {{
              datosPrestatario.calle1 && datosPrestatario.calle2
                ? datosPrestatario.calle1 + " y " + datosPrestatario.calle2
                : "—"
            }}
          </div>
        </div>
        <div class="field">
          <label>Estado</label>
          <div class="static-box">
            {{ datosPrestatario.estado ? "Activo" : "Inactivo" }}
          </div>
        </div>
      </div>

      <div
        class="alert warn"
        *ngIf="tipo === 2 && !datosPrestatario.nombre_negocio"
      >
        Perfil de prestatario incompleto. Completa los datos para solicitar
        préstamos.
      </div>

      <div class="actions">
        <button class="primary" (click)="editarPerfil()">Editar perfil</button>
      </div>
    </section>

    <!-- Panel lateral -->
    <aside class="panel side-panel">
      <h3>Resumen</h3>
      <ul class="stats">
        <li>
          <label>Nombre</label>
          <span
            >{{ datosUsuario.nombre || "—" }}
            {{ datosUsuario.apellido || "" }}</span
          >
        </li>
        <li>
          <label>Tipo</label>
          <span>{{
            tipo === 1 ? "Prestamista" : tipo === 2 ? "Prestatario" : "Admin"
          }}</span>
        </li>
        <li *ngIf="tipo === 1">
          <label>Capital</label>
          <span>{{ datosPrestamista.capital || 0 | currency : "USD" }}</span>
        </li>
        <li *ngIf="tipo === 2">
          <label>Ingresos</label>
          <span>{{
            datosPrestatario.ingreso_mensual || 0 | currency : "USD"
          }}</span>
        </li>
        <li>
          <label>Ciudad</label>
          <span>{{
            datosUsuario.nombre_ciudad || datosPrestatario.nombre_ciudad || "—"
          }}</span>
        </li>
      </ul>
      <div class="note">
        Mantén tus datos actualizados para mejorar tu experiencia.
      </div>
    </aside>
  </div>
</div>

<ng-template #cargandoPerfil>
  <div class="perfil-vacio"><p>Cargando datos del perfil...</p></div>
</ng-template>
